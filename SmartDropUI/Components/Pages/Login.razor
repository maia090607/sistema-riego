@page "/login"
@inject NavigationManager Navigation
@inject AuthService AuthService

<div class="login-page">
    <div class="floating-icon" style="top: 10%; left: 10%;">💧</div>
    <div class="floating-icon" style="top: 20%; right: 15%;">🌱</div>
    <div class="floating-icon" style="bottom: 15%; left: 15%;">💧</div>
    <div class="floating-icon" style="bottom: 25%; right: 10%;">🌿</div>

    <div class="login-card">
        <div class="logo-container">
            <span>🌿</span>
            <span>💧</span>
            <span>🌱</span>
        </div>
        <h1>SmartDrop</h1>
        <p class="subtitle">Sistema de Riego Automático Inteligente</p>

        @if (!string.IsNullOrEmpty(errorMessage))
        {
            <div class="alert alert-danger">@errorMessage</div>
        }

        <div class="input-group">
            <label>Usuario</label>
            <div class="input-wrapper">
                <span>👤</span>
                <input type="text" @bind="username" placeholder="admin" />
            </div>
        </div>

        <div class="input-group">
            <label>Contraseña</label>
            <div class="input-wrapper">
                <span>🔒</span>
                <input type="@(showPassword ? "text" : "password")" @bind="password" placeholder="admin123" @onkeypress="HandleKeyPress" />
                <span style="cursor: pointer;" @onclick="TogglePassword">👁️</span>
            </div>
        </div>

        <button class="btn btn-primary" @onclick="IniciarSesion">
            <span>🚀</span>
            INICIAR SESIÓN
        </button>

        <button class="btn btn-secondary" @onclick="CrearCuenta">
            <span>✨</span>
            CREAR CUENTA
        </button>
    </div>
</div>

@code {
    private string username = "";
    private string password = "";
    private string errorMessage = "";
    private bool showPassword = false;

    private void TogglePassword()
    {
        showPassword = !showPassword;
    }

    private async Task IniciarSesion()
    {
        if (string.IsNullOrWhiteSpace(username) || string.IsNullOrWhiteSpace(password))
        {
            errorMessage = "Por favor ingrese usuario y contraseña";
            return;
        }

        var result = await AuthService.Login(username, password);

        if (result)
        {
            Navigation.NavigateTo("/dashboard");
        }
        else
        {
            errorMessage = "Usuario o contraseña incorrectos";
        }
    }

    private void CrearCuenta()
    {
        Navigation.NavigateTo("/registro");
    }

    private async Task HandleKeyPress(KeyboardEventArgs e)
    {
        if (e.Key == "Enter")
        {
            await IniciarSesion();
        }
    }
}