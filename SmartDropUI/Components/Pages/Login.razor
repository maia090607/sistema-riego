@page "/login"
@using SmartDropUI.Models
@using SmartDropUI.Services
@inject AuthService AuthService
@inject NavigationManager Navigation
@rendermode InteractiveServer

<PageTitle>SmartDrop - Login</PageTitle>

<style>
    body {
        margin: 0;
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    }

    .login-page {
        min-height: 100vh;
        background: linear-gradient(135deg, #d1fae5 0%, #ccfbf1 50%, #cffafe 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2rem;
        position: relative;
        overflow: hidden;
    }

    .decorations {
        position: absolute;
        inset: 0;
        pointer-events: none;
        z-index: 1;
    }

    .floating-leaf, .floating-droplet {
        position: absolute;
        opacity: 0.3;
        font-size: 3rem;
    }

    .leaf-1 {
        top: 10%;
        left: 10%;
        animation: float-gentle 6s ease-in-out infinite;
    }

    .leaf-2 {
        bottom: 15%;
        left: 5%;
        animation: float-gentle 8s ease-in-out infinite 1s;
    }

    .leaf-3 {
        bottom: 10%;
        right: 8%;
        animation: float-gentle 7s ease-in-out infinite 2s;
    }

    .droplet-1 {
        top: 8%;
        right: 15%;
        animation: bounce-gentle 3s ease-in-out infinite;
    }

    .droplet-2 {
        top: 50%;
        right: 5%;
        animation: bounce-gentle 4s ease-in-out infinite 1.5s;
    }

    .droplet-3 {
        bottom: 30%;
        left: 15%;
        animation: bounce-gentle 5s ease-in-out infinite 0.5s;
    }

    @@keyframes float-gentle {
        0%, 100% {
            transform: translateY(0) rotate(0deg);
        }

        50% {
            transform: translateY(-20px) rotate(5deg);
        }
    }

    @@keyframes bounce-gentle {
        0%, 100% {
            transform: translateY(0);
        }

        50% {
            transform: translateY(-15px);
        }
    }

    .login-card {
        background: white;
        border-radius: 2rem;
        box-shadow: 0 20px 60px -15px rgba(0, 0, 0, 0.2);
        padding: 3rem 2.5rem;
        width: 100%;
        max-width: 460px;
        position: relative;
        z-index: 10;
    }

    .logo-section {
        text-align: center;
        margin-bottom: 2rem;
    }

    .logo-icons {
        display: flex;
        justify-content: center;
        gap: 0.75rem;
        margin-bottom: 1.5rem;
        font-size: 3.5rem;
    }

    .app-title {
        font-size: 2.75rem;
        font-weight: bold;
        color: #10b981;
        margin-bottom: 0.5rem;
        letter-spacing: -0.5px;
    }

    .app-subtitle {
        color: #6b7280;
        font-size: 1rem;
    }

    .login-form-container {
        margin-top: 2.5rem;
    }

    .form-field {
        margin-bottom: 1.5rem;
    }

        .form-field label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }

    .input-group {
        position: relative;
        display: flex;
        align-items: center;
    }

    .input-icon {
        position: absolute;
        left: 1rem;
        font-size: 1.4rem;
        z-index: 2;
    }

    .form-control {
        width: 100%;
        padding: 0.9rem 1rem 0.9rem 3.25rem;
        border: 2px solid #e5e7eb;
        border-radius: 0.75rem;
        font-size: 1rem;
        transition: all 0.3s ease;
        background: white;
        color: #1f2937;
    }

        .form-control::placeholder {
            color: #d1d5db;
        }

        .form-control:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }

    .password-toggle {
        position: absolute;
        right: 1rem;
        background: none;
        border: none;
        cursor: pointer;
        font-size: 1.25rem;
        padding: 0.25rem;
        z-index: 2;
        transition: transform 0.2s;
    }

        .password-toggle:hover {
            transform: scale(1.15);
        }

    .btn {
        width: 100%;
        padding: 1rem;
        border: none;
        border-radius: 0.75rem;
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        transition: all 0.3s ease;
        margin-bottom: 0.75rem;
    }

    .btn-primary {
        background: #3b82f6;
        color: white;
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }

        .btn-primary:hover:not(:disabled) {
            background: #2563eb;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

    .btn-secondary {
        background: #10b981;
        color: white;
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

        .btn-secondary:hover {
            background: #059669;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
        }

    .btn-icon {
        font-size: 1.25rem;
    }

    .alert {
        padding: 0.875rem;
        border-radius: 0.75rem;
        font-size: 0.9rem;
        text-align: center;
        margin-bottom: 1rem;
    }

    .alert-error {
        background-color: #fee2e2;
        color: #991b1b;
        border: 1px solid #fecaca;
    }

    .alert-success {
        background-color: #d1fae5;
        color: #065f46;
        border: 1px solid #a7f3d0;
    }

    @@media (max-width: 480px) {
        .login-card {
            padding: 2rem 1.5rem;
        }

        .app-title {
            font-size: 2.25rem;
        }

        .logo-icons {
            font-size: 3rem;
        }
    }
</style>

<div class="login-page">
    <div class="decorations">
        <div class="floating-leaf leaf-1">🌿</div>
        <div class="floating-leaf leaf-2">🍃</div>
        <div class="floating-leaf leaf-3">🌱</div>
        <div class="floating-droplet droplet-1">💧</div>
        <div class="floating-droplet droplet-2">💧</div>
        <div class="floating-droplet droplet-3">💧</div>
    </div>

    <div class="login-card">
        <div class="logo-section">
            <div class="logo-icons">
                <span>🌿</span>
                <span>💧</span>
            </div>
            <h1 class="app-title">SmartDrop</h1>
            <p class="app-subtitle">Sistema de Riego Automático</p>
        </div>

        <div class="login-form-container">
            <div class="form-field">
                <label>Usuario</label>
                <div class="input-group">
                    <span class="input-icon">👤</span>
                    <input type="text"
                           @bind="loginModel.Usuario"
                           placeholder="Usuario"
                           class="form-control" />
                </div>
            </div>

            <div class="form-field">
                <label>Contraseña</label>
                <div class="input-group">
                    <span class="input-icon">🔒</span>
                    <input type="@(mostrarPassword ? "text" : "password")"
                           @bind="loginModel.Password"
                           placeholder="Contraseña"
                           class="form-control" />
                    <button type="button"
                            class="password-toggle"
                            @onclick="() => mostrarPassword = !mostrarPassword">
                        @(mostrarPassword ? "🙈" : "👁️")
                    </button>
                </div>
            </div>

            @if (!string.IsNullOrEmpty(mensajeError))
            {
                <div class="alert alert-error">@mensajeError</div>
            }

            <button class="btn btn-primary" @onclick="HandleLogin" disabled="@cargando">
                <span class="btn-icon">💧</span>
                @(cargando ? "Accediendo..." : "Acceder")
            </button>

            <button class="btn btn-secondary" @onclick='() => Navigation.NavigateTo("/registro")'>
                <span class="btn-icon">✨</span>
                Crear Cuenta
            </button>
        </div>
    </div>
</div>

@code {
    private LoginModel loginModel = new();
    private bool mostrarPassword = false;
    private bool cargando = false;
    private string mensajeError = string.Empty;

    private async Task HandleLogin()
    {
        cargando = true;
        mensajeError = string.Empty;

        if (string.IsNullOrWhiteSpace(loginModel.Usuario) ||
            string.IsNullOrWhiteSpace(loginModel.Password))
        {
            mensajeError = "Por favor complete todos los campos";
            cargando = false;
            return;
        }

        await Task.Delay(500);
        Navigation.NavigateTo("/dashboard");
        cargando = false;
    }
}