@using SmartDropUI.Models
@using SmartDropUI.Services
@inject AuthService AuthService
@inject NavigationManager Navigation

<div class="login-container">

    <!-- formulario de login ... -->

    <button class="btn-primary" @onclick="HandleLogin" disabled="@cargando">
        <span class="btn-icon">💧</span>
        @(cargando ? "Cargando..." : "Acceder")
    </button>

    <button class="btn-secondary" @onclick="IrARegistroClick">
        <span class="btn-icon">➕</span>
        Crear Cuenta
    </button>
</div>

@code {
    [Parameter] public EventCallback OnLoginExitoso { get; set; }
    [Parameter] public EventCallback OnIrARegistro { get; set; }

    private LoginModel loginModel = new();
    private bool mostrarPassword = false;
    private bool cargando = false;
    private string mensajeError = "";

    private async Task HandleLogin()
    {
        cargando = true;
        mensajeError = "";

        if (string.IsNullOrWhiteSpace(loginModel.Usuario) ||
            string.IsNullOrWhiteSpace(loginModel.Password))
        {
            mensajeError = "Complete todos los campos";
            cargando = false;
            return;
        }

        var ok = await AuthService.LoginAsync(loginModel);

        if (ok)
            await OnLoginExitoso.InvokeAsync();
        else
            mensajeError = "Usuario o contraseña incorrectos";

        cargando = false;
    }

    private async Task IrARegistroClick() =>
        await OnIrARegistro.InvokeAsync();
}
