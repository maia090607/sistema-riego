@using SmartDropUI.Models
@using SmartDropUI.Services
@inject AuthService AuthService

<div class="registro-container">
    <!-- formulario de registro ... -->
</div>

@code {
    [Parameter] public EventCallback OnRegistroExitoso { get; set; }
    [Parameter] public EventCallback OnVolverALogin { get; set; }

    private UsuarioModel formRegistro = new();
    private bool mostrarPasswordRegistro = false;
    private bool cargando = false;
    private string mensajeError = "";
    private string mensajeExito = "";

    private async Task HandleRegistro()
    {
        mensajeError = "";
        mensajeExito = "";

        if (string.IsNullOrWhiteSpace(formRegistro.NombreUsuario) ||
            string.IsNullOrWhiteSpace(formRegistro.Contrasena))
        {
            mensajeError = "Complete todos los campos";
            return;
        }

        cargando = true;
        bool ok = await AuthService.RegistrarAsync(formRegistro);

        if (ok)
        {
            mensajeExito = "Usuario creado exitosamente";
            await Task.Delay(1200);
            await OnRegistroExitoso.InvokeAsync();
        }
        else
        {
            mensajeError = "Error al crear usuario";
        }

        cargando = false;
    }

    private async Task IrALogin() =>
        await OnVolverALogin.InvokeAsync();
}
