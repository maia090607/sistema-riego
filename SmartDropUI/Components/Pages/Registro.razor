@using SmartDropUI.Models
@using SmartDropUI.Services
@inject AuthService AuthService

<div class="registro-container">
    <!-- Tu código HTML actual de registro -->
</div>

@code {
    [Parameter] public EventCallback OnRegistroExitoso { get; set; }
    [Parameter] public EventCallback OnVolverALogin { get; set; }

    private UsuarioModel formRegistro = new();
    private bool mostrarPasswordRegistro = false;
    private bool cargando = false;
    private string mensajeError = "";
    private string mensajeExito = "";

    private void ToggleMostrarPasswordRegistro() => mostrarPasswordRegistro = !mostrarPasswordRegistro;

    private async Task HandleRegistro()
    {
        mensajeError = "";
        mensajeExito = "";

        if (string.IsNullOrWhiteSpace(formRegistro.NombreUsuario) ||
            string.IsNullOrWhiteSpace(formRegistro.Contrasena))
        {
            mensajeError = "Complete los campos requeridos";
            return;
        }

        cargando = true;
        bool registroExitoso = await AuthService.RegistrarAsync(formRegistro);

        if (registroExitoso)
        {
            mensajeExito = "Usuario creado exitosamente";
            await Task.Delay(1500);
            formRegistro = new UsuarioModel();
            await OnRegistroExitoso.InvokeAsync();
        }
        else
        {
            mensajeError = "Error al crear el usuario. Intente nuevamente.";
        }
        cargando = false;
    }

    private async Task IrALogin() => await OnVolverALogin.InvokeAsync();
}