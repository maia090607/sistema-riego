@page "/dashboard"
@inject NavigationManager Navigation
@inject AuthService AuthService
@inject RiegoService RiegoService

@if (!AuthService.IsAuthenticated)
{
    Navigation.NavigateTo("/login");
}

<div class="dashboard-page">
    <button class="logout-btn" @onclick="CerrarSesion">🚪 Cerrar Sesión</button>

    <div class="dashboard-header">
        <h1>SISTEMA DE RIEGO AUTOMÁTICO SMARTDROP</h1>
        <p>Panel de Control y Monitoreo en Tiempo Real</p>
    </div>

    <div class="dashboard-grid">
        <!-- Temperatura -->
        <div class="card">
            <div class="card-icon">🌡️</div>
            <div class="card-title">Temperatura</div>
            <div class="card-value temperature">@datosRiego.Temperatura°C</div>
        </div>

        <!-- Humedad del Aire -->
        <div class="card">
            <div class="card-icon">💧</div>
            <div class="card-title">Humedad del Aire</div>
            <div class="card-value humidity">@datosRiego.HumedadAire</div>
        </div>

        <!-- Bomba de Agua -->
        <div class="card">
            <div class="card-icon">⚙️</div>
            <div class="card-title">Bomba de Agua Estado</div>
            <div style="text-align: center;">
                <span class="status-badge @(datosRiego.BombaActiva ? "status-active" : "status-inactive")">
                    ● @(datosRiego.BombaActiva ? "Activa" : "Inactiva")
                </span>
            </div>
        </div>

        <!-- Último Riego -->
        <div class="card">
            <div class="card-icon">📅</div>
            <div class="card-title">Último Riego Fecha</div>
            <div style="text-align: center;">
                <span class="status-badge status-online">@datosRiego.UltimoRiego</span>
            </div>
        </div>

        <!-- Pronóstico -->
        <div class="card">
            <div class="card-icon">☀️</div>
            <div class="card-title">Pronóstico</div>
            <div class="card-value forecast">@datosRiego.Pronostico</div>
        </div>

        <!-- Viento -->
        <div class="card">
            <div class="card-icon">💨</div>
            <div class="card-title">Viento</div>
            <div class="card-value wind">@datosRiego.Viento</div>
        </div>

        <!-- Estado del Programa -->
        <div class="card">
            <div class="card-icon">💻</div>
            <div class="card-title">Estado del Programa</div>
            <div style="text-align: center;">
                <span class="status-badge status-online">● Online</span>
            </div>
        </div>

        <!-- Humedad del Suelo -->
        <div class="card">
            <div class="card-icon">🌱</div>
            <div class="card-title">Humedad del Suelo</div>
            <div style="text-align: center;">
                <span class="status-badge status-humid">@datosRiego.HumedadSuelo</span>
            </div>
        </div>
    </div>
</div>

@code {
    private DatosRiegoModel datosRiego = new DatosRiegoModel();

    protected override async Task OnInitializedAsync()
    {
        if (!AuthService.IsAuthenticated)
        {
            Navigation.NavigateTo("/login");
            return;
        }

        await CargarDatos();
    }

    private async Task CargarDatos()
    {
        datosRiego = await RiegoService.ObtenerDatosRiego();
    }

    private void CerrarSesion()
    {
        AuthService.Logout();
        Navigation.NavigateTo("/login");
    }
}